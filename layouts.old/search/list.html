{{ define "main" }}
{{ partial "search-form.html" . }}

<ul id="results">
    <li>
        Enter a keyword above to search this site.
    </li>
</ul>
<script>
// Simple client-side search using public/index.json
document.addEventListener('DOMContentLoaded', function() {
    console.log('Search script loaded');
    const form = document.getElementById('search');
    const input = document.getElementById('search-input');
    const results = document.getElementById('results');
    console.log('form:', form);
    console.log('input:', input);
    console.log('results:', results);
    let indexData = [];

    // Load search index
    fetch('/index.json')
        .then(res => res.json())
        .then(data => {
            indexData = data;
            console.log('index.json loaded:', indexData.length, 'items');
        })
        .catch(err => {
            console.error('Failed to load index.json:', err);
        });

    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const query = input.value.trim().toLowerCase();
            results.innerHTML = '';
            console.log('Search submitted:', query);
            if (!query) {
                results.innerHTML = '<li>Enter a keyword above to search this site.</li>';
                return;
            }
            const matches = indexData.filter(item =>
                item.title && item.title.toLowerCase().includes(query) ||
                item.summary && item.summary.toLowerCase().includes(query) ||
                item.content && item.content.toLowerCase().includes(query)
            );
            console.log('Matches found:', matches.length);
            if (matches.length === 0) {
                results.innerHTML = '<li>No results found.</li>';
                return;
            }
            matches.forEach(item => {
                const li = document.createElement('li');
            li.innerHTML = `<a href="${item.permalink}">${item.title}</a><br><small>${item.summary || ''}</small>`;
            results.appendChild(li);
        });
    });
});
</script>
{{ end }}